# DOCS

## Purpose
The API module provides the unified HTTP surface for illuu, including namespaced routes for memory, intent, vault, and governance, plus legacy route compatibility for existing clients.

## Scope

### In Scope
- FastAPI application in `api/app.py`.
- Namespaced routes under `/memory`, `/intent`, `/vault`.
- Legacy root routes (`/ingest`, `/query`, `/inject-intent`, `/verify-intent`, `/execute`).
- Request ID middleware in `api/middleware/request_id.py`.

### Out of Scope
- Business logic for governance or vault (owned by `governance/` and `vault/`).
- Enforcement logic (owned by `governance/`).
- Storage and ledger persistence (owned by `vault/` and `state/`).

## Architecture
`api/app.py` builds a FastAPI application with middleware and routers. Routers are generated by `api/routers/*` and mounted in both namespaced and legacy forms. The memory and intent routers maintain their current behavior and use in-process logic. The vault router delegates to external services via HTTP (see Interfaces).

Text diagram:

```
Client
  -> api/app.py
    -> /memory/* -> api/routers/memory.py
    -> /intent/* -> api/routers/intent.py
    -> /vault/*  -> api/routers/vault.py
    -> /governance/health -> api/routers/governance.py
```

## Interfaces

### HTTP Endpoints
- `GET /health` (root health).
- Memory:
  - `POST /memory/ingest` and legacy `POST /ingest`.
  - `GET /memory/query` and legacy `GET /query`.
  - `GET /memory/health`.
- Intent:
  - `POST /intent/inject-intent` and legacy `POST /inject-intent`.
  - `POST /intent/verify-intent` and legacy `POST /verify-intent`.
  - `GET /intent/health`.
- Vault:
  - `POST /vault/execute` and legacy `POST /execute`.
  - `GET /vault/health`.
- Governance:
  - `GET /governance/health`.

### Schemas
- `api/schemas/memory.py`: `IngestRequest`, `IngestResponse`, `QueryResponse`.
- `api/schemas/intent.py`: `InjectIntentRequest`, `InjectIntentResponse`, `VerifyIntentRequest`, `VerifyIntentResponse`.
- `api/schemas/vault.py`: `ExecuteRequest`, `ExecuteResponse`.
- `api/schemas/governance.py`: `AuthorizeRequest`, `AuthorizeResponse`.

### External Dependencies
- `api/routers/vault.py` calls:
  - `INTENT_ENGINE` at `http://localhost:8000` (`/authorize-intent`).
  - `PRIVATE_VAULT` at `http://localhost:8001` (`/vault/secure-action`).

## Security & Compliance
- `api/middleware/auth.py` and `api/middleware/audit.py` are placeholders and do not enforce authentication or audit logging in code.
- Request correlation IDs are set via `api/middleware/request_id.py` using `X-Request-ID` headers.
- Governance enforcement is not applied in this module; it is expected to be enforced downstream.

## Testing Strategy
- `api/tests/test_unified_routes.py` validates that OpenAPI includes both namespaced and legacy routes.
- Integration tests for downstream systems are not present in this module.

## Failure Modes
- Downstream service unavailability for `vault/execute` leads to HTTP errors from external dependencies.
- In-memory intent store resets on process restart (`api/routers/intent.py`).
- No authentication enforcement means API is not secure by default.

## Observability
- Request IDs are added to responses via `X-Request-ID` header.
- No structured logging or tracing instrumentation is present in this module.

## Operational Runbook
- Deployment: run FastAPI app in `api/app.py`.
- Rollback: redeploy previous container or artifact.
- Upgrades: ensure legacy routes remain available for existing clients.
- Incident response: capture API access logs and downstream service logs.

## Ownership
- Owning team: Platform API.
- Review process: API contract changes require governance review.
- Escalation path: API On‑Call -> Platform SRE -> Security.
- SLA expectations: Tier‑1 for control plane and health endpoints.

## Roadmap
- Replace in-memory intent store with persistence.
- Enforce authentication and audit middleware.
- Route all execution through governance gateway.
